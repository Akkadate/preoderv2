# ğŸ“‹ Workflow: Local Development â†’ Railway Deploy

## ğŸ”„ à¸‚à¸±à¹‰à¸™à¸•à¸­à¸™à¸à¸²à¸£à¸à¸±à¸’à¸™à¸²à¹à¸¥à¸° Deploy

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. à¹à¸à¹‰à¹„à¸‚ Code / Schema à¹ƒà¸™ Local                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  2. à¸–à¹‰à¸²à¹à¸à¹‰ schema.prisma â†’ à¸£à¸±à¸™ migrate dev                  â”‚
â”‚     npx prisma migrate dev --name descriptive_name          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  3. à¸—à¸”à¸ªà¸­à¸šà¹ƒà¸™ Local (npm run dev)                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  4. Commit à¸—à¸¸à¸à¹„à¸Ÿà¸¥à¹Œà¸—à¸µà¹ˆà¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™                                  â”‚
â”‚     git add .                                               â”‚
â”‚     git commit -m "feat: add new feature"                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  5. Push à¸‚à¸¶à¹‰à¸™ GitHub                                        â”‚
â”‚     git push                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  6. Railway Auto-Deploy âœ¨                                  â”‚
â”‚     (à¸£à¸±à¸™ prisma migrate deploy à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´à¸•à¸­à¸™ start)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âš ï¸ à¸à¸à¸ªà¸³à¸„à¸±à¸à¹€à¸à¸·à¹ˆà¸­à¸«à¸¥à¸µà¸à¹€à¸¥à¸µà¹ˆà¸¢à¸‡ Error

| âŒ à¸­à¸¢à¹ˆà¸²à¸—à¸³ | âœ… à¹ƒà¸«à¹‰à¸—à¸³ |
|----------|---------|
| à¸£à¸±à¸™ `migrate dev` à¸à¸±à¸š Production DB | à¹ƒà¸Šà¹‰ `migrate dev` à¸à¸±à¸š Local à¹€à¸—à¹ˆà¸²à¸™à¸±à¹‰à¸™ |
| à¹à¸à¹‰à¹„à¸‚ migration file à¸—à¸µà¹ˆ commit à¹à¸¥à¹‰à¸§ | à¸ªà¸£à¹‰à¸²à¸‡ migration à¹ƒà¸«à¸¡à¹ˆà¹à¸—à¸™ |
| à¹ƒà¸ªà¹ˆ `DATABASE_URL` à¸‚à¸­à¸‡ Railway à¹ƒà¸™ `.env` | à¸›à¸¥à¹ˆà¸­à¸¢à¹ƒà¸«à¹‰ Railway inject à¹€à¸­à¸‡ |
| Push à¸à¹ˆà¸­à¸™à¸—à¸”à¸ªà¸­à¸š | à¸—à¸”à¸ªà¸­à¸šà¹ƒà¸™ Local à¸à¹ˆà¸­à¸™à¹€à¸ªà¸¡à¸­ |
| à¹ƒà¸Šà¹‰ `$env:DATABASE_URL=...` à¹à¸¥à¹‰à¸§à¸£à¸±à¸™ `migrate dev` | Clear env à¸à¹ˆà¸­à¸™ à¸«à¸£à¸·à¸­à¹€à¸›à¸´à¸” terminal à¹ƒà¸«à¸¡à¹ˆ |

---

## ğŸ“ à¹„à¸Ÿà¸¥à¹Œà¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡ Commit à¹€à¸¡à¸·à¹ˆà¸­à¸¡à¸µà¸à¸²à¸£à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™ Database

```
prisma/
â”œâ”€â”€ schema.prisma          â† à¸­à¸±à¸à¹€à¸”à¸—à¹€à¸ªà¸¡à¸­
â””â”€â”€ migrations/
    â””â”€â”€ 20260114XXXXXX_your_feature/
        â””â”€â”€ migration.sql  â† à¸ªà¸£à¹‰à¸²à¸‡à¹‚à¸”à¸¢ migrate dev
```

---

## ğŸŒ Environment Configuration (SaaS-Ready)

### à¹„à¸Ÿà¸¥à¹Œ Environment

| à¹„à¸Ÿà¸¥à¹Œ | à¹ƒà¸Šà¹‰à¸—à¸³à¸­à¸°à¹„à¸£ | Commit à¹„à¸«à¸¡ |
|------|----------|-----------|
| `.env` | Template + shared config (à¹„à¸¡à¹ˆà¸¡à¸µ secrets) | âœ… Yes |
| `.env.local` | **Local development** (DATABASE_URL local) | âŒ No |
| `.env.production` | Production secrets (à¸–à¹‰à¸²à¸ˆà¸³à¹€à¸›à¹‡à¸™) | âŒ No |

### ğŸ”’ à¸à¸à¹€à¸«à¸¥à¹‡à¸: DATABASE_URL

```bash
# âœ… .env.local - à¹ƒà¸Šà¹‰ local database à¹€à¸—à¹ˆà¸²à¸™à¸±à¹‰à¸™
DATABASE_URL="postgresql://postgres:password@localhost:5432/merchant_saas"

# âŒ à¸­à¸¢à¹ˆà¸²à¹€à¸à¹‡à¸š production URL à¹ƒà¸™ file à¹ƒà¸”à¹†
# Railway à¸ˆà¸° inject DATABASE_URL à¹€à¸­à¸‡à¸•à¸­à¸™ runtime
```

### âš ï¸ à¸à¹ˆà¸­à¸™à¸£à¸±à¸™ Prisma command à¹ƒà¸”à¹† - à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸à¹ˆà¸­à¸™!

```powershell
# à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸§à¹ˆà¸²à¸Šà¸µà¹‰à¹„à¸› local
echo $env:DATABASE_URL

# à¸–à¹‰à¸²à¹€à¸«à¹‡à¸™ "railway" à¸«à¸£à¸·à¸­ "proxy.rlwy.net" = à¸­à¸±à¸™à¸•à¸£à¸²à¸¢!
# à¹ƒà¸«à¹‰à¸›à¸´à¸” terminal à¹à¸¥à¹‰à¸§à¹€à¸›à¸´à¸”à¹ƒà¸«à¸¡à¹ˆ
```

---

## ğŸ› ï¸ à¸„à¸³à¸ªà¸±à¹ˆà¸‡à¸—à¸µà¹ˆà¹ƒà¸Šà¹‰à¸šà¹ˆà¸­à¸¢

### Local Development
```bash
# à¸£à¸±à¸™ dev server
npm run dev

# à¸ªà¸£à¹‰à¸²à¸‡ migration à¹ƒà¸«à¸¡à¹ˆ (à¸«à¸¥à¸±à¸‡à¹à¸à¹‰ schema.prisma)
npx prisma migrate dev --name feature_name

# à¸”à¸¹ migration status
npx prisma migrate status

# Reset local database (à¸¥à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”)
npx prisma migrate reset

# Seed à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™
npx prisma db seed
```

### Production (Railway) - à¹ƒà¸Šà¹‰à¹€à¸¡à¸·à¹ˆà¸­à¸¡à¸µà¸›à¸±à¸à¸«à¸²à¹€à¸—à¹ˆà¸²à¸™à¸±à¹‰à¸™
```powershell
# à¸•à¸±à¹‰à¸‡ DATABASE_URL à¸Šà¸±à¹ˆà¸§à¸„à¸£à¸²à¸§ (à¹ƒà¸Šà¹‰ Public URL à¸ˆà¸²à¸ Railway Dashboard)
$env:DATABASE_URL="postgresql://...public-url..."; npx prisma migrate status

# Mark migration as applied (à¸–à¹‰à¸² migration failed à¹à¸•à¹ˆà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸¡à¸µà¸­à¸¢à¸¹à¹ˆà¹à¸¥à¹‰à¸§)
$env:DATABASE_URL="postgresql://..."; npx prisma migrate resolve --applied MIGRATION_NAME

# Mark migration as rolled-back (à¸–à¹‰à¸² migration failed à¹à¸¥à¸°à¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¸£à¸±à¸™à¹ƒà¸«à¸¡à¹ˆ)
$env:DATABASE_URL="postgresql://..."; npx prisma migrate resolve --rolled-back MIGRATION_NAME
```

---

## ğŸš¨ à¸§à¸´à¸˜à¸µà¹à¸à¹‰à¹„à¸‚à¹€à¸¡à¸·à¹ˆà¸­ Railway Deploy Error

### Error: P3009 (Migration failed)
1. à¹„à¸›à¸—à¸µà¹ˆ Railway Dashboard â†’ Postgres â†’ Connect
2. Copy **Public Connection URL**
3. à¸£à¸±à¸™:
   ```powershell
   $env:DATABASE_URL="<PUBLIC_URL>"; npx prisma migrate resolve --applied <MIGRATION_NAME>
   ```
4. Redeploy

### Error: P1001 (Can't reach database)
- à¸–à¹‰à¸²à¹€à¸à¸´à¸”à¸•à¸­à¸™ **Build** â†’ à¹„à¸¡à¹ˆà¸•à¹‰à¸­à¸‡à¸—à¸³à¸­à¸°à¹„à¸£ (à¸›à¸à¸•à¸´)
- à¸–à¹‰à¸²à¹€à¸à¸´à¸”à¸•à¸­à¸™ **Start** â†’ à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸§à¹ˆà¸² Postgres service à¸£à¸±à¸™à¸­à¸¢à¸¹à¹ˆ

### Error: Column already exists / Column does not exist
- à¹ƒà¸Šà¹‰ `prisma migrate resolve --applied` à¸–à¹‰à¸²à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸¡à¸µà¸­à¸¢à¸¹à¹ˆà¹à¸¥à¹‰à¸§
- à¸«à¸£à¸·à¸­à¸£à¸±à¸™ SQL à¸•à¸£à¸‡à¹† à¸œà¹ˆà¸²à¸™ `railway connect postgres`

---

## ğŸ“… à¸­à¸±à¸à¹€à¸”à¸—à¸¥à¹ˆà¸²à¸ªà¸¸à¸”
- **2026-01-14**: à¸ªà¸£à¹‰à¸²à¸‡à¹€à¸­à¸à¸ªà¸²à¸£à¸™à¸µà¹‰à¸«à¸¥à¸±à¸‡à¹à¸à¹‰à¸›à¸±à¸à¸«à¸² P3009 migration error
